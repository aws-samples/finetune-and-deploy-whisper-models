# 语音识别与评估工具

该工具对音频文件进行语音识别，并使用多种指标评估转录质量。

## 功能

- 支持多个输入目录
- 批量处理音频文件
- 使用Whisper模型进行语音识别
- 支持LoRA微调
- 计算词错误率(WER)和其他指标
- 为每个数据集生成详细日志


## 使用方法

```bash
python speech_recognition_evaluation.py --data-dirs <目录1> <目录2> ... --language <语言> [选项]
```

### 参数

- `--data-dirs`: 数据目录列表(必需)
- `--language`: 音频语言(必需:'en', 'ms', 'id', 或 'zh')
- `--model-id`: Hugging Face模型ID (默认: 'openai/whisper-large-v3')
- `--batch-size`: 推理的批量大小 (默认: 16)
- `--chunk-length`: 每个块的输入长度(秒) (默认: 60)
- `--log-path`: 日志目录路径 (默认: './logs')
- `--device`: 使用的设备 (默认: 'cuda')
- `--lora-path`: LoRA文件路径(可选)
- `--prompt`: 模型的预定义提示(可选)

## 示例

```bash
python speech_recognition_evaluation.py --data-dirs /path/to/dataset1 /path/to/dataset2 --language zh --model-id openai/whisper-large-v3 --batch-size 32 --lora-path /path/to/lora/weights
```

## 数据格式

该工具期望在每个数据目录中有一个`trans.txt`文件，格式如下:

```
audio_file1.wav    音频文件1的转录
audio_file2.wav    音频文件2的转录
...
```

示例:
```
rec1.wav    你好世界
rec2.wav    语音识别真是太神奇了
```

## 输出

该工具生成:
1. 包含每个数据集指标和总体结果的摘要表
2. 每个数据集的详细日志文件，包括错误分析

示例输出表格:

```
┏━━━━━━━━━━┳━━━━━━━━━┳━━━━━┳━━━━━┳━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 数据集    ┃ 总句数   ┃ 插入 ┃ 删除 ┃ 替换 ┃ 匹配  ┃ WER                           ┃
┡━━━━━━━━━━╇━━━━━━━━━╇━━━━━╇━━━━━╇━━━━━╇━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ 数据集1   │     100 │  10 │  15 │  20 │   955 │ 45 / 1000 = 0.0450            │
│ 数据集2   │     200 │  25 │  30 │  35 │  1910 │ 90 / 2000 = 0.0450            │
│ 总体      │     300 │  35 │  45 │  55 │  2865 │ 135 / 3000 = 0.0450           │
└──────────┴─────────┴─────┴─────┴─────┴───────┴───────────────────────────────┘
```
